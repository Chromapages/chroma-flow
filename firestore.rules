rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Helper function to get user's ID
    function getUserId() {
      return request.auth.uid;
    }

    // Clients collection - require auth, allow team access
    match /clients/{clientId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated() && request.resource.data.keys().hasAll(['name', 'email', 'status']);
      allow update: if isAuthenticated() && request.resource.data.keys().hasAll(['name', 'email', 'status']);
      allow delete: if isAuthenticated();
    }

    // Leads collection - require auth
    match /leads/{leadId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated() && request.resource.data.keys().hasAll(['name', 'email', 'pipeline_stage']);
      allow update: if isAuthenticated() && request.resource.data.keys().hasAll(['name', 'email', 'pipeline_stage']);
      allow delete: if isAuthenticated();
    }

    // Campaigns collection - require auth
    match /campaigns/{campaignId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated() && request.resource.data.keys().hasAll(['name', 'status']);
      allow update: if isAuthenticated() && request.resource.data.keys().hasAll(['name', 'status']);
      allow delete: if isAuthenticated();
    }

    // Content collection - require auth
    match /contents/{contentId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated() && request.resource.data.keys().hasAll(['title', 'content_type', 'status']);
      allow update: if isAuthenticated() && request.resource.data.keys().hasAll(['title', 'content_type', 'status']);
      allow delete: if isAuthenticated();
    }

    // Deliverables collection - require auth
    match /deliverables/{deliverableId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated() && request.resource.data.keys().hasAll(['name', 'client_id', 'status']);
      allow update: if isAuthenticated() && request.resource.data.keys().hasAll(['name', 'client_id', 'status']);
      allow delete: if isAuthenticated();
    }

    // Default deny all
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
